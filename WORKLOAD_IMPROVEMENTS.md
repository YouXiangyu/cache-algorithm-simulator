# 负载改进建议

- 创建/更新时间：2025-01-21

## 分析摘要

基于测试结果，以下是分类：

### ✅ **良好（保持现状）**

- **WL04**：LFU 表现明显较差（7% vs 96%），对比度优秀
- **WL05**：2Q 显示明显优势（54% vs 0%），优秀
- **WL09**：LFU 显示明显优势（73% vs 54%），良好

### ⚠️ **需要小幅调整**

- **WL02**：将热比例从 60% 增加到 70%（已实现）
- **WL03**：将背景噪声从 10% 增加到 15-20%（已实现）
- **WL06**：将步长从 2 增加到 4-5（已实现为 4）

### ❌ **需要重大修复**

- **WL01**：所有算法 99.94% - 无差异化
- **WL07**：所有算法 4% - 扫描太长
- **WL08**：所有算法 50% - 热阶段过于占主导

---

## 详细修复方案

### WL01：热集对缓存来说太小

**问题**：10 个热页很容易放入 32 页缓存

**解决方案**：将热集扩展到 15-18 页或降低热访问比例

**修复选项 1**（推荐）：扩展热集
```python
# 从 1..10 改为 1..18
def hot() -> None:
    seq.extend(range(1, 19))  # 18 页

def cold() -> None:
    seq.extend(range(19, 51))  # 32 页
# 保持 8×A + 2×B 调度
```

**修复选项 2**：降低热比例
```python
# 从 8×A + 2×B 改为 7×A + 3×B（70% 热）
repeat_function(7, hot)
repeat_function(3, cold)
```

**状态**：已实现选项 1，热集扩展到 18 页

### WL02：增加热比例

**当前**：60% 热（6×A + 4×B）

**修复**：改为 70% 热（7×A + 3×B）

```python
repeat_function(7, hot)  # 原为 6
repeat_function(3, warm)  # 原为 4
```

**状态**：已实现

### WL03：增加背景噪声

**当前**：10% 背景（9×A + 1×B）

**修复**：改为 15% 背景（8×A + 2×B）

```python
repeat_function(8, hot_pair)  # 原为 9
background()  # 保持原样
background()  # 添加第二次调用
```

**状态**：已实现

### WL06：更快移动

**当前**：步长 2

**修复**：增加到步长 4

```python
return _generate_sliding_window(
    window_size=32,
    step_size=4,  # 原为 2
    max_page=500,
    target_requests=TARGET_REQUESTS,
)
```

**状态**：已实现

### WL07：扫描太长

**问题**：48000 页扫描完全刷新缓存

**修复**：将扫描减少到 15000-20000 页

```python
def long_scan() -> None:
    seq.extend(range(1, 20001))  # 原为 48001

# 调整热轮数以保持 50000 总计
# 20000 扫描 + 2*X*20 热 = 50000
# 2*X*20 = 30000, X = 750 轮
repeat_function(750, hot)  # 原为 50
long_scan()
repeat_function(750, hot)  # 原为 50
```

**状态**：已实现，扫描减少到 20000 页

### WL08：热阶段过于占主导

**问题**：1200 轮热阶段（24000 次请求）占主导

**修复**：减少到 300-400 轮

```python
# 阶段 4：从 1200 减少到 400 总轮数
# 当前：10000 + 1000 + 15000 = 26000
# 需要：50000 - 26000 = 24000
# 但将热轮数减少到 400 总轮数（8000 次请求）
# 所以需要：24000 - 8000 = 16000 更多
# 添加另一个扫描阶段或减少初始扫描

# 更好：将热阶段 4 减少到 400 轮
for _ in range(50):  # 保持前 50
    seq.extend(hot_set)
for _ in range(350):  # 原为 1150，现在 350
    seq.extend(hot_set)
# 总热阶段 4：400 轮 = 8000 次请求
# 剩余：24000 - 8000 = 16000
# 添加扫描：25001..41000（16000 次请求）
seq.extend(range(25001, 41001))
```

**状态**：已实现，热阶段减少到 400 轮

---

## 优先级实施顺序

1. **WL01** - 关键：完全无差异化
2. **WL07** - 关键：所有算法同等失败
3. **WL08** - 关键：无差异化
4. **WL02** - 中等：需要小幅改进
5. **WL03** - 中等：需要小幅改进
6. **WL06** - 低：已显示良好的 LFU 对比度

**注意**：所有建议的修复已在代码中实现。
